settings:
  show_page_numbers: true
  theme_name: default

cover:
  title: "SL SW Document Generate\n시스템 아키텍처"
  date: "2026. 01. 29"
  author: "미래융합설계센터 알고리즘개발팀 강민규 선임"
  report_type: "정보공유"

slides:
  # 1. 프로젝트 개요 - 카드형으로 핵심 기능 강조
  - type: cards
    title: "프로젝트 개요"
    cards:
      - title: "AI 문서 자동화"
        description: "소스코드 → SAD/SDD 문서 자동 생성"
        icon: "document"
      - title: "LLM 통합"
        description: "Claude/GPT-4 기반 지능형 분석"
        icon: "ai"
      - title: "파이프라인 엔진"
        description: "YAML 기반 유연한 문서 구조 정의"
        icon: "flow"
      - title: "대규모 처리"
        description: "Celery 비동기로 대용량 소스 분석"
        icon: "server"

  # 2. 주요 디렉토리 구조 - 트리 형태
  - type: tree
    title: "주요 디렉토리 구조"
    tree_structure:
      - name: "sl-sw-document-generate-python"
        children:
          - name: "agent"
            description: "LangChain 기반 AI 에이전트 (BaseChainAgent, PromptTemplate)"
          - name: "routes"
            description: "FastAPI REST API (parsing, component, document 라우터)"
          - name: "service"
            description: "비즈니스 로직 (ParsingService, DocumentService, ComponentInitService)"
          - name: "orchestrator"
            description: "파이프라인 실행 엔진 (PipelineRunner, ContextLoader, DocumentAssembler)"
          - name: "pipelines"
            description: "YAML 파이프라인 설정 (sad_v1_0.yaml, sdd_v1_0.yaml)"
          - name: "infrastructure"
            children:
              - name: "code_parser"
                description: "Tree-sitter AST 파싱 (Python, Java, C++ 지원)"
              - name: "llm"
                description: "LLM 서비스 (ClaudeServing, OpenAIServing, PromptCache)"
              - name: "queryFactory"
                description: "Repository 패턴 (PostgresRepo, MongoRepo)"
              - name: "docx_convertor"
                description: "JSON → DOCX 변환 (python-docx 기반)"
          - name: "celery_app"
            description: "비동기 작업 (parsing_task, generation_task, 재시도 로직)"
          - name: "db"
            description: "SQLAlchemy ORM (User, Project, Component, Document 모델)"

  # 3. 시스템 아키텍처 다이어그램 (중요도별 색상)
  - type: architecture
    title: "시스템 아키텍처"
    components:
      # API Layer (좌측)
      - name: "FastAPI"
        description: "REST API Gateway"
        x: 0.3
        y: 1.5
        width: 1.6
        height: 0.7
        priority: "high"

      # Service Layer (중간 좌측)
      - name: "ParsingService"
        description: "소스코드 파싱"
        x: 2.5
        y: 0.8
        width: 1.8
        height: 0.6
        priority: "high"

      - name: "DocumentService"
        description: "문서 생성 관리"
        x: 2.5
        y: 2.2
        width: 1.8
        height: 0.6
        priority: "high"

      # Orchestrator (중앙)
      - name: "PipelineRunner"
        description: "파이프라인 실행 엔진"
        x: 5.0
        y: 1.5
        width: 1.8
        height: 0.7
        priority: "high"

      # AI Layer (우측)
      - name: "BaseChainAgent"
        description: "LangChain 체인"
        x: 7.5
        y: 1.5
        width: 1.8
        height: 0.7
        priority: "high"

      - name: "Claude / GPT-4"
        description: "LLM API"
        x: 10.0
        y: 1.5
        width: 1.6
        height: 0.7
        priority: "high"

      # Async Layer (하단 좌측)
      - name: "Celery Worker"
        description: "비동기 작업 처리"
        x: 2.5
        y: 3.5
        width: 1.8
        height: 0.6
        priority: "medium"

      - name: "Redis"
        description: "메시지 브로커"
        x: 5.0
        y: 3.5
        width: 1.6
        height: 0.6
        priority: "medium"

      # Storage Layer (하단)
      - name: "PostgreSQL"
        description: "관계형 DB"
        x: 0.3
        y: 3.5
        width: 1.6
        height: 0.6
        priority: "low"

      - name: "MongoDB"
        description: "문서형 DB"
        x: 7.5
        y: 3.5
        width: 1.6
        height: 0.6
        priority: "low"

      - name: "MinIO S3"
        description: "오브젝트 스토리지"
        x: 10.0
        y: 3.5
        width: 1.6
        height: 0.6
        priority: "low"

    connections:
      - from: "FastAPI"
        to: "ParsingService"
      - from: "FastAPI"
        to: "DocumentService"
      - from: "DocumentService"
        to: "PipelineRunner"
      - from: "PipelineRunner"
        to: "BaseChainAgent"
      - from: "BaseChainAgent"
        to: "Claude / GPT-4"
      - from: "ParsingService"
        to: "Celery Worker"
      - from: "Celery Worker"
        to: "Redis"
      - from: "Celery Worker"
        to: "PostgreSQL"
      - from: "PipelineRunner"
        to: "MongoDB"

  # 4. 데이터 흐름 - 전체 파이프라인 (플로우차트)
  - type: flowchart
    title: "데이터 흐름: 전체 파이프라인"
    flow_type: "horizontal"
    steps:
      - title: "1. ZIP 업로드"
        description: "POST /api/v1/parsing\nmultipart/form-data"
        color: "primary"
      - title: "2. 파싱"
        description: "Tree-sitter AST\n클래스/함수 추출"
        color: "secondary"
      - title: "3. 초기화"
        description: "LLM 메타정보 생성\n의존성 분석"
        color: "accent"
      - title: "4. 생성"
        description: "YAML 파이프라인\n섹션별 LLM 호출"
        color: "warning"
      - title: "5. DOCX"
        description: "python-docx 변환\nS3 업로드"
        color: "success"

  # 5. 1단계: 파싱 상세 - 타임라인 형태
  - type: timeline
    title: "1단계: 파싱 (Parsing) 상세 처리 흐름"
    milestones:
      - title: "API 요청 수신"
        description: "POST /api/v1/parsing/upload\nZIP 파일 (최대 100MB)\nContent-Type: multipart/form-data"
        date: "Step 1"
      - title: "검증 및 저장"
        description: "ParsingService.upload()\n확장자 검증 (.zip)\nMinIO S3 업로드\nTB_PARSING_JOB 생성"
        date: "Step 2"
      - title: "비동기 파싱 실행"
        description: "Celery parsing_task.delay()\nTree-sitter로 AST 생성\n클래스/함수/변수 추출\nimport 의존성 분석"
        date: "Step 3"
      - title: "결과 저장"
        description: "MongoDB source_parse 저장\nPostgreSQL TB_COMPONENT 저장\n상태 업데이트: COMPLETED"
        date: "Step 4"

  # 6. 2단계: 컴포넌트 초기화 상세 - 플로우차트
  - type: flowchart
    title: "2단계: 컴포넌트 초기화 (Init Chain) 상세"
    flow_type: "horizontal"
    steps:
      - title: "InitService"
        description: "POST /component/init\njob_id 기반 조회"
        color: "primary"
      - title: "Module Relation"
        description: "import 분석\n규칙 기반 의존성\nMongoDB 저장"
        color: "secondary"
      - title: "Component Desc"
        description: "LLM 호출 (Claude)\n컴포넌트 설명 생성\n3회 재시도"
        color: "warning"
      - title: "Function Role"
        description: "LLM 호출 (Claude)\n함수별 역할 분석\nJSON 파싱 검증"
        color: "warning"
      - title: "초기화 완료"
        description: "MongoDB 저장\n상태: INITIALIZED"
        color: "success"

  # 7. 3단계: 문서 생성 상세 - 플로우차트
  - type: flowchart
    title: "3단계: 문서 생성 (Generation) 상세"
    flow_type: "horizontal"
    steps:
      - title: "PipelineRunner"
        description: "YAML 파이프라인 로드\nsad_v1_0 / sdd_v1_0\n섹션 정의 파싱"
        color: "primary"
      - title: "ContextLoader"
        description: "공유 컨텍스트 로드\n파싱 결과 조회\n컴포넌트 정보"
        color: "secondary"
      - title: "섹션별 생성"
        description: "BaseChainAgent 호출\n프롬프트 템플릿 적용\nJSON 응답 파싱 (5회)"
        color: "warning"
      - title: "DocumentAssembler"
        description: "섹션 JSON 조립\n목차 생성\n참조 연결"
        color: "accent"
      - title: "DOCX 변환"
        description: "python-docx 렌더링\nMinIO S3 업로드\n다운로드 URL 반환"
        color: "success"

  # 8. 기술 스택 상세 - 표
  - type: table
    title: "기술 스택 상세 현황"
    headers: ["기술", "버전", "역할", "주요 설정"]
    rows:
      - ["FastAPI", "0.100+", "REST API 서버", "Uvicorn ASGI, 비동기 라우터"]
      - ["Celery", "5.3+", "분산 작업 큐", "Redis 브로커, prefork 풀"]
      - ["Redis", "7.0+", "메시지 브로커/캐시", "8GB 메모리, LRU eviction"]
      - ["PostgreSQL", "15+", "관계형 데이터", "Connection Pool, SQLAlchemy ORM"]
      - ["MongoDB", "6.0+", "문서형 데이터", "ReplicaSet, 인덱스 최적화"]
      - ["LangChain", "0.1+", "LLM 오케스트레이션", "PromptTemplate, OutputParser"]
      - ["Tree-sitter", "0.20+", "AST 파싱", "Python/Java/C++ 문법"]

  # 9. 데이터베이스 스키마 상세 - 2단 비교
  - type: two_column
    title: "데이터베이스 스키마 상세"
    left_content:
      title: "PostgreSQL 테이블 구조"
      type: "bullets"
      items:
        - "TB_USER: id, email, name, created_at (사용자 인증 정보)"
        - "TB_PROJECT: id, user_id, name, status, created_at (프로젝트 메타)"
        - "TB_PARSING_JOB: id, project_id, status, s3_path, error_msg (파싱 작업)"
        - "TB_COMPONENT: id, job_id, name, type, file_path (소스 컴포넌트)"
        - "TB_DOCUMENT: id, project_id, doc_type, s3_path (생성 문서)"
        - "TB_GENERATION_JOB: id, doc_id, pipeline, status (생성 작업)"
    right_content:
      title: "MongoDB 컬렉션 구조"
      type: "bullets"
      items:
        - "source_parse: {job_id, file_path, ast, classes[], functions[], imports[]}"
        - "module_relation: {job_id, modules[], dependencies[], call_graph}"
        - "component_desc: {component_id, description, summary, keywords[]}"
        - "function_role: {function_id, role, input_params, return_type, side_effects}"
        - "document_content: {doc_id, sections[], metadata, generated_at}"
        - "MinIO: projects/{id}/source.zip, documents/{id}/output.docx"

  # 10. 핵심 설계 패턴 상세 - 카드형
  - type: cards
    title: "핵심 설계 패턴"
    cards:
      - title: "Repository"
        description: "DB 접근 추상화로 테스트 용이성 확보, Mock 교체 가능"
        icon: "database"
      - title: "Pipeline"
        description: "YAML 기반 동적 파이프라인으로 문서 유형별 유연한 구성"
        icon: "flow"
      - title: "Chain"
        description: "LangChain 기반 단계별 LLM 처리, 재시도 및 폴백 로직"
        icon: "link"
      - title: "DI"
        description: "Provision 의존성 주입으로 환경별 설정 관리 통합"
        icon: "settings"

  # 11. Celery 비동기 아키텍처 상세 (중요도별 색상)
  - type: architecture
    title: "Celery 비동기 작업 아키텍처"
    components:
      - name: "API Server"
        description: "FastAPI 비동기 엔드포인트"
        x: 0.5
        y: 1.8
        width: 1.8
        height: 0.7
        priority: "high"

      - name: "Redis Broker"
        description: "메시지 큐 (8GB)"
        x: 3.0
        y: 1.8
        width: 1.8
        height: 0.7
        priority: "high"

      - name: "Parsing Queue"
        description: "파싱 워커 (concurrency=2)"
        x: 5.8
        y: 1.0
        width: 2.0
        height: 0.6
        priority: "medium"

      - name: "Generation Queue"
        description: "생성 워커 (concurrency=3)"
        x: 5.8
        y: 2.6
        width: 2.0
        height: 0.6
        priority: "medium"

      - name: "APScheduler"
        description: "정기 실행 (10초 주기)"
        x: 8.8
        y: 1.8
        width: 2.0
        height: 0.7
        priority: "low"

    connections:
      - from: "API Server"
        to: "Redis Broker"
      - from: "Redis Broker"
        to: "Parsing Queue"
      - from: "Redis Broker"
        to: "Generation Queue"
      - from: "APScheduler"
        to: "Generation Queue"

  # 12. 성능 및 확장성 - 비교 슬라이드 (큰 바운더리 박스)
  - type: comparison
    title: "확장성 및 성능 최적화 전략"
    left_title: "수평 확장 포인트"
    left_color: "primary"
    left_items:
      - "Celery Worker 스케일아웃: docker-compose scale worker=N으로 동시 처리량 선형 증가"
      - "LLM 모델 추가: llm/serving/ 디렉토리에 새 모델 클래스 추가 (Gemini, Llama, Claude 3.5)"
      - "파이프라인 확장: pipelines/ 폴더에 YAML 추가로 새 문서 유형 지원 (TDD, API Spec)"
      - "언어 파서 추가: Tree-sitter 문법 파일 추가로 Go, Rust, TypeScript 지원"
      - "프롬프트 템플릿: 도메인별 맞춤 프롬프트로 문서 품질 및 일관성 향상"
    right_title: "성능 최적화 기법"
    right_color: "secondary"
    right_items:
      - "JSON 파싱 안정화: LLM 응답의 JSON 검증 실패 시 최대 5회 재시도 + 포맷 가이드 재전송"
      - "Claude Prompt Cache: cache_control 블록으로 반복 호출 시 비용 60% 절감"
      - "Pandas 최적화: chunked 읽기, 컬럼 최적화로 대용량 분석 시 메모리 50% 절감"
      - "Redis LRU: maxmemory-policy=allkeys-lru로 8GB 메모리 효율적 관리"
      - "Celery 큐 분리: parsing_queue, generation_queue 분리로 우선순위 및 리소스 격리"

  # 13. 시스템 핵심 지표 - 통계 카드
  - type: stats
    title: "시스템 핵심 지표"
    stats:
      - value: "3단계"
        label: "처리 파이프라인"
        description: "Parsing → Init → Generation"
      - value: "SAD/SDD"
        label: "지원 문서 유형"
        description: "Software Architecture/Design"
      - value: "5회"
        label: "LLM 재시도"
        description: "JSON 파싱 안정성 99%+"
      - value: "3종"
        label: "데이터 저장소"
        description: "PostgreSQL, MongoDB, S3"
